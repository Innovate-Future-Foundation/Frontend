jenkins:
  systemMessage: "Jenkins configured automatically by Configuration as Code plugin"
  
  securityRealm:
    local:
      allowsSignup: false
      users:
        - id: "{{ jenkins_admin_username }}"
          password: "{{ jenkins_admin_password }}"
  
  # authorizationStrategy:
  #   loggedInUsersCanDoAnything:
  #     allowAnonymousRead: false

  authorizationStrategy:
    globalMatrix:
      permissions:
        - "Overall/Administer:{{ jenkins_admin_username }}"
        - "Overall/Read:authenticated"
        - "Job/Create:{{ jenkins_admin_username }}"
        - "Job/Delete:{{ jenkins_admin_username }}"
        - "Job/Configure:{{ jenkins_admin_username }}"
        - "Job/Read:authenticated"
        - "Job/Build:authenticated"

  numExecutors: 2

  globalNodeProperties:
    - envVars:
        env:
          - key: JENKINS_URL
            value: "https://jenkins.{{ domain_name }}"  # 使用 HTTPS 和域名

  # 添加 jobs 配置
  jobs:
    - script: >
        pipelineJob('frontend-pipeline') {
          description('Frontend CI/CD Pipeline')
          
          definition {
            cpsScm {
              scm {
                git {
                  remote {
                    url('https://github.com/innovate-Future-Foundation/Frontend.git')
                    credentials('github-credentials')
                  }
                  branch('*/devops/dylan-v2')
                }
              }
              scriptPath('Jenkinsfile')
            }
          }
          
          properties {
            githubProjectProperty {
              projectUrlStr('https://github.com/innovate-Future-Foundation/Frontend')
            }
          }
          
          triggers {
            githubPush()
          }
        }

  tool:
    nodejs:
      installations:
        - name: "Node18"
          properties:
            - installSource:
                installers:
                  - nodeJS:
                      id: "{{ jenkins_nodejs_version }}"

    git:
      installations:
        - name: "Default"
          home: "git"

  credentials:
    system:
      domainCredentials:
        - credentials:
            - usernamePassword:
                scope: GLOBAL
                id: "aws-credentials"
                username: "{{ jenkins_aws_access_key }}"
                password: "{{ jenkins_aws_secret_key }}"
                description: "AWS credentials"
            - usernamePassword:
                scope: GLOBAL
                id: "github-credentials"
                username: "{{ jenkins_github_username }}"
                password: "{{ jenkins_github_token }}"
                description: "GitHub credentials"

unclassified:
  location:
    url: "https://jenkins.{{ domain_name }}"  # 使用 HTTPS 和域名
  gitHubPluginConfig:
    configs:
      - credentialsId: "github-credentials"
        name: "GitHub"